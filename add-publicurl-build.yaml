- hosts: master

  tasks:
    - name: add FQDN to /etc/hosts to default-image
      blockinfile:
        path: /cm/images/default-image/etc/hosts
        insertafter: '^# END AUTOGENERATED SECTION'
        marker: "# {mark} ANSIBLE MANAGED BLOCK"
        backup: yes
        block: |
          # this FQDN is needed across the cluster to support the public endpoint URLs
          # we use the external IP since it is reachable and doesn't conflict with the 
          # bright-maintained internal IP aliases. 
          192.168.16.10           ruffner.rc.uab.edu

    - name: add FQDN to /etc/hosts to nova-compute
      blockinfile:
        path: /cm/images/nova-compute/etc/hosts
        insertafter: '^# END AUTOGENERATED SECTION'
        marker: "# {mark} ANSIBLE MANAGED BLOCK"
        backup: yes
        block: |
          # this FQDN is needed across the cluster to support the public endpoint URLs
          # we use the external IP since it is reachable and doesn't conflict with the 
          # bright-maintained internal IP aliases. 
          192.168.16.10           ruffner.rc.uab.edu
